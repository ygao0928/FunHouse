<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wechat.mbg.mapper.MemberInfoMapper">

    <resultMap id="BaseResultMap" type="wechat.mbg.entity.MemberInfo" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
        <result column="open_id" property="openId" jdbcType="INTEGER" />
        <result column="telephone" property="telephone" jdbcType="VARCHAR" />
        <result column="appsecret" property="appsecret" jdbcType="VARCHAR" />
        <result column="app_id" property="appId" jdbcType="INTEGER" />
        <result column="gender" property="gender" jdbcType="INTEGER" />
        <result column="member_recharge_level" property="memberRechargeLevel" jdbcType="INTEGER" />
        <result column="is_admin" property="isAdmin" jdbcType="TINYINT" />
        <result column="member_played_level" property="memberPlayedLevel" jdbcType="INTEGER" />
        <result column="balance" property="balance" jdbcType="DECIMAL" />
        <result column="total_cost" property="totalCost" jdbcType="DECIMAL" />
        <result column="total_recharge" property="totalRecharge" jdbcType="DECIMAL" />
        <result column="remaining_points" property="remainingPoints" jdbcType="INTEGER" />
        <result column="total_points" property="totalPoints" jdbcType="INTEGER" />
        <result column="played_counts" property="playedCounts" jdbcType="INTEGER" />
        <result column="member_discount" property="memberDiscount" jdbcType="INTEGER" />
    </resultMap>

    <sql id="Base_Column_List" >
    id, nick_name, open_id, telephone, appsecret, app_id, gender, member_recharge_level,
    is_admin, member_played_level, balance, total_cost, total_recharge, remaining_points,
    total_points, played_counts, member_discount
     </sql>

    <insert id="insertOrUpdateMemberInfo">
        if not exists (select 1 from member_info where open_id = #{openId} )
            insert into member_info (nick_name, open_id,
              telephone, appsecret, app_id,
              gender, member_recharge_level, is_admin,
              member_played_level, balance, total_cost,
              total_recharge, remaining_points, total_points,
              played_counts, member_discount)
            values (#{nickName,jdbcType=VARCHAR}, #{openId,jdbcType=INTEGER},
              #{telephone,jdbcType=VARCHAR}, #{appsecret,jdbcType=VARCHAR}, #{appId,jdbcType=INTEGER},
              #{gender,jdbcType=INTEGER}, #{memberRechargeLevel,jdbcType=INTEGER}, #{isAdmin,jdbcType=TINYINT},
              #{memberPlayedLevel,jdbcType=INTEGER}, #{balance,jdbcType=DECIMAL}, #{totalCost,jdbcType=DECIMAL},
              #{totalRecharge,jdbcType=DECIMAL}, #{remainingPoints,jdbcType=INTEGER}, #{totalPoints,jdbcType=INTEGER},
              #{playedCounts,jdbcType=INTEGER}, #{memberDiscount,jdbcType=INTEGER})
        else
        update member_info
        <set >
            <if test="nickName != null" >
                nick_name = #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="openId != null" >
                open_id = #{openId,jdbcType=INTEGER},
            </if>
            <if test="telephone != null" >
                telephone = #{telephone,jdbcType=VARCHAR},
            </if>
            <if test="appsecret != null" >
                appsecret = #{appsecret,jdbcType=VARCHAR},
            </if>
            <if test="appId != null" >
                app_id = #{appId,jdbcType=INTEGER},
            </if>
            <if test="gender != null" >
                gender = #{gender,jdbcType=INTEGER},
            </if>
            <if test="memberRechargeLevel != null" >
                member_recharge_level = #{memberRechargeLevel,jdbcType=INTEGER},
            </if>
            <if test="isAdmin != null" >
                is_admin = #{isAdmin,jdbcType=TINYINT},
            </if>
            <if test="memberPlayedLevel != null" >
                member_played_level = #{memberPlayedLevel,jdbcType=INTEGER},
            </if>
            <if test="balance != null" >
                balance = #{balance,jdbcType=DECIMAL},
            </if>
            <if test="totalCost != null" >
                total_cost = #{totalCost,jdbcType=DECIMAL},
            </if>
            <if test="totalRecharge != null" >
                total_recharge = #{totalRecharge,jdbcType=DECIMAL},
            </if>
            <if test="remainingPoints != null" >
                remaining_points = #{remainingPoints,jdbcType=INTEGER},
            </if>
            <if test="totalPoints != null" >
                total_points = #{totalPoints,jdbcType=INTEGER},
            </if>
            <if test="playedCounts != null" >
                played_counts = #{playedCounts,jdbcType=INTEGER},
            </if>
            <if test="memberDiscount != null" >
                member_discount = #{memberDiscount,jdbcType=INTEGER},
            </if>
        </set>
        where open_id = #{openId}
    </insert>
    <insert id="insertSelective">
        insert into member_info
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="nickName != null" >
                nick_name,
            </if>
            <if test="openId != null" >
                open_id,
            </if>
            <if test="telephone != null" >
                telephone,
            </if>
            <if test="appsecret != null" >
                appsecret,
            </if>
            <if test="appId != null" >
                app_id,
            </if>
            <if test="gender != null" >
                gender,
            </if>
            <if test="memberRechargeLevel != null" >
                member_recharge_level,
            </if>
            <if test="isAdmin != null" >
                is_admin,
            </if>
            <if test="memberPlayedLevel != null" >
                member_played_level,
            </if>
            <if test="balance != null" >
                balance,
            </if>
            <if test="totalCost != null" >
                total_cost,
            </if>
            <if test="totalRecharge != null" >
                total_recharge,
            </if>
            <if test="remainingPoints != null" >
                remaining_points,
            </if>
            <if test="totalPoints != null" >
                total_points,
            </if>
            <if test="playedCounts != null" >
                played_counts,
            </if>
            <if test="memberDiscount != null" >
                member_discount,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="nickName != null" >
                #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="openId != null" >
                #{openId,jdbcType=INTEGER},
            </if>
            <if test="telephone != null" >
                #{telephone,jdbcType=VARCHAR},
            </if>
            <if test="appsecret != null" >
                #{appsecret,jdbcType=VARCHAR},
            </if>
            <if test="appId != null" >
                #{appId,jdbcType=INTEGER},
            </if>
            <if test="gender != null" >
                #{gender,jdbcType=INTEGER},
            </if>
            <if test="memberRechargeLevel != null" >
                #{memberRechargeLevel,jdbcType=INTEGER},
            </if>
            <if test="isAdmin != null" >
                #{isAdmin,jdbcType=TINYINT},
            </if>
            <if test="memberPlayedLevel != null" >
                #{memberPlayedLevel,jdbcType=INTEGER},
            </if>
            <if test="balance != null" >
                #{balance,jdbcType=DECIMAL},
            </if>
            <if test="totalCost != null" >
                #{totalCost,jdbcType=DECIMAL},
            </if>
            <if test="totalRecharge != null" >
                #{totalRecharge,jdbcType=DECIMAL},
            </if>
            <if test="remainingPoints != null" >
                #{remainingPoints,jdbcType=INTEGER},
            </if>
            <if test="totalPoints != null" >
                #{totalPoints,jdbcType=INTEGER},
            </if>
            <if test="playedCounts != null" >
                #{playedCounts,jdbcType=INTEGER},
            </if>
            <if test="memberDiscount != null" >
                #{memberDiscount,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByOpenIdSelective">
        update member_info
        <set >
            <if test="nickName != null" >
                nick_name = #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="openId != null" >
                open_id = #{openId,jdbcType=INTEGER},
            </if>
            <if test="telephone != null" >
                telephone = #{telephone,jdbcType=VARCHAR},
            </if>
            <if test="appsecret != null" >
                appsecret = #{appsecret,jdbcType=VARCHAR},
            </if>
            <if test="appId != null" >
                app_id = #{appId,jdbcType=INTEGER},
            </if>
            <if test="gender != null" >
                gender = #{gender,jdbcType=INTEGER},
            </if>
            <if test="memberRechargeLevel != null" >
                member_recharge_level = #{memberRechargeLevel,jdbcType=INTEGER},
            </if>
            <if test="isAdmin != null" >
                is_admin = #{isAdmin,jdbcType=TINYINT},
            </if>
            <if test="memberPlayedLevel != null" >
                member_played_level = #{memberPlayedLevel,jdbcType=INTEGER},
            </if>
            <if test="balance != null" >
                balance = #{balance,jdbcType=DECIMAL},
            </if>
            <if test="totalCost != null" >
                total_cost = #{totalCost,jdbcType=DECIMAL},
            </if>
            <if test="totalRecharge != null" >
                total_recharge = #{totalRecharge,jdbcType=DECIMAL},
            </if>
            <if test="remainingPoints != null" >
                remaining_points = #{remainingPoints,jdbcType=INTEGER},
            </if>
            <if test="totalPoints != null" >
                total_points = #{totalPoints,jdbcType=INTEGER},
            </if>
            <if test="playedCounts != null" >
                played_counts = #{playedCounts,jdbcType=INTEGER},
            </if>
            <if test="memberDiscount != null" >
                member_discount = #{memberDiscount,jdbcType=INTEGER},
            </if>
        </set>
        where open_id = #{openId,jdbcType=INTEGER}
    </update>
    <select id="showMemberInfoById" resultType="wechat.mbg.entity.MemberInfo">
        select * from member_info where open_id=#{openId}
    </select>
    <select id="showTopTenMemebers" resultType="wechat.mbg.entity.RechargeRecord">
        select top 10 * from member_info order by total_recharge desc
    </select>

</mapper>
